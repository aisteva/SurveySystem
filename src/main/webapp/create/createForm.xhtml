<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:a="http://xmlns.jcp.org/jsf/passthrough">
<h:head>
   <title>Nauja apklausa</title>
   <h:outputStylesheet name="/css/create/style.css" />
</h:head>
<f:metadata>
   <f:viewParam name="person" value="#{signInController.loggedInPerson.personID}" />
   <f:viewAction action="#{signInController.isSigned}" />
</f:metadata>
<h:body>
   <ui:include src="../header.xhtml"/>

   <div class="container content">

      <h:form>
         <div class="surveyTitle">
            <h:inputText value="" a:placeholder="Apklausos pavadinimas"/>
         </div>

         <div class="surveyDetails">
            <div class="surveyDescription">
               <h:inputTextarea value="#{createFormController.survey.description}" a:placeholder="Aprašymas "></h:inputTextarea>
            </div>
            <div>
               <p:outputLabel for="startDate" value="Pradžios data*"/>
               <p:calendar id="startDate" value="#{createFormController.survey.startDate}"/>
            </div>
            <div>
               <p:outputLabel for="endDate" value="Pabaigos data"/>
               <p:calendar id="endDate" value="#{createFormController.survey.endDate}"/>
            </div>
         </div>
         <h:panelGroup id="survey" >
         <ui:repeat  value="#{createFormController.getQuestions()}" var="question" varStatus="questionStatus">
            <div class="one-question">
               #{question.setQuestionNumber(questionStatus.index)}
               <div class="question-text">
                  <h:inputText value="#{question.questionText}" a:placeholder="Klausimas">
                     <f:ajax render="@form"/>
                  </h:inputText>
               </div>
               <div class="question-type">
                  <h:selectOneMenu value="#{question.type}">
                     <f:selectItems value = "#{question.types}"/>
                     <f:ajax render="@form"/>
                  </h:selectOneMenu>
               </div>
               <div class="answers">
                  <h:panelGroup rendered="#{question.type == 'TEXT'}">
                     <ui:include src="text.xhtml"/>
                  </h:panelGroup>
                  <h:panelGroup rendered="#{question.type == 'CHECKBOX'}">
                     <ui:include src="checkbox.xhtml"/>
                  </h:panelGroup>
                  <h:panelGroup rendered="#{question.type == 'MULTIPLE_CHOICE'}">
                     <ui:include src="multiplechoice.xhtml"/>
                  </h:panelGroup>
                  <h:panelGroup rendered="#{question.type == 'SCALE'}">
                     <ui:include src="scale.xhtml"/>
                  </h:panelGroup>
               </div>

               <hr/>
               <div class="actions-with-question">
                  <div class="remove-question">
                     <h:graphicImage value="../resources/images/remove.png">
                        <f:ajax event="click" listener="#{createFormController.onButtonRemoveQuestionClick(question)}" immediate="true" render="@form"  />
                     </h:graphicImage>
                  </div>
                  <div class="required">
                     <p:selectBooleanCheckbox value="#{question.required}" itemLabel="Privalomas"/>
                  </div>
               </div>
            </div>
         </ui:repeat>

         </h:panelGroup>


         <h:graphicImage value="../resources/images/add.png" styleClass="add-question">
            <f:ajax event="click" listener="#{createFormController.onButtonAddQuestionClick()}" execute="@form" render="survey" />
         </h:graphicImage>

         <p:commandButton value="Submit form"
                          action="#{createFormController.createForm(signInController.loggedInPerson.email)}"
                          ajax="false"/>

         <p:messages globalOnly="true"/>
      </h:form>
   </div>
   <ui:include src="../footer.xhtml"/>
</h:body>
</html>
